<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>USOTOREã‚¹ãƒãƒ›ç‰ˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0a0a0a;--panel:#0f0f10;--text:#f3f4f6;--win:#22c55e;--lose:#ef4444;--gold:#fbbf24;--cyan:#38bdf8;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:"Rajdhani","Noto Sans JP",sans-serif;overflow:hidden;}
  #chart{width:100vw;height:58vh;background:#0b0b10;display:block;}
  #title{text-align:center;position:relative;top:4px;font-size:28px;letter-spacing:8px;font-weight:700;color:rgba(251,191,36,0.88);text-shadow:0 0 20px rgba(251,191,36,0.35);}

  .pill{
    position:absolute;right:12px;top:8px;background:rgba(0,0,0,.55);
    border:1px solid #374151;padding:6px;border-radius:10px;font-size:13px
  }

  .hud{background:rgba(0,0,0,.55);border:1px solid #374151;
    border-radius:10px;padding:10px;margin:6px auto;width:92%;backdrop-filter:blur(4px);font-size:14px}

  .row{display:flex;gap:8px;align-items:center;margin-top:6px}
  .row label{min-width:92px;font-size:12px;color:#cbd5e1}
  .row input,.row select{flex:1;padding:8px;border-radius:8px;border:1px solid #334155;background:#0e0e12;color:#fff;font-size:14px}

  .btn{flex:1;padding:10px;border:none;border-radius:10px;font-weight:800;color:#111}
  .btnH{background:linear-gradient(90deg,#16a34a,#22c55e)}
  .btnL{background:linear-gradient(90deg,#ef4444,#f43f5e)}

  .list{margin-top:8px;max-height:118px;overflow:auto;border-top:1px dashed #334155;padding-top:6px;font-size:12px}
  .ticket{display:flex;justify-content:space-between;padding:6px 8px;border:1px solid #334155;
          border-radius:6px;margin-bottom:6px;background:#0c0c12}
  .ticket.win{border-color:rgba(34,197,94,.6)}.ticket.lose{border-color:rgba(239,68,68,.6)}

  /* å±¥æ­´ãƒ­ã‚°é ˜åŸŸ */
  .history-log-container{
    background:#0a0a0a;border-top:1px solid #334155;font-size:12px;
    height:24vh;overflow-y:auto;padding:8px;
  }
  .history-entry{border-bottom:1px solid #334155;padding:6px 0}
  .history-entry.win{color:rgba(34,197,94,.85)}
  .history-entry.lose{color:rgba(239,68,68,.85)}
</style>
</head>

<body>
<div id="title">ï¼µï¼³ï¼¯ï¼´ï¼¯ï¼²ï¼¥</div>
<div class="pill" id="rateText">---</div>
<canvas id="chart"></canvas>

<div class="hud">
  <h3 style="margin:0 0 4px;">å–å¼•</h3>
  <div class="row">
    <label>åˆ¤å®šæ™‚é–“</label>
    <select id="expirySelect">
      <option value="0.5">30ç§’</option>
      <option value="1">1åˆ†</option>
      <option value="5">5åˆ†</option>
      <option value="10">10åˆ†</option>
      <option value="20">20åˆ†</option>
      <option value="custom">ä»»æ„ï¼ˆåˆ†ï¼‰</option>
    </select>
  </div>
  <div class="row" id="customRow" style="display:none;">
    <label>ä»»æ„åˆ†æ•°</label><input id="expiryCustomMin" type="number" value="3" min="0.5" max="240" step="0.5"><span>åˆ†</span>
  </div>
  <div class="row"><label>è³­ã‘é‡‘</label><input id="stake" type="number" value="1000" min="100" step="100"></div>
  <div class="row"><label>ãƒšã‚¤ã‚¢ã‚¦ãƒˆ</label><input id="payout" type="number" value="1.8" step="0.05"></div>
  <div class="row" style="gap:6px;"><button class="btn btnH" onclick="enter('HIGH')">HIGH â†‘</button><button class="btn btnL" onclick="enter('LOW')">LOW â†“</button></div>
  <div class="row"><label>æ®‹é«˜</label><div id="bal">Â¥1,000,000</div></div>
  <div class="list" id="tickets"></div>
</div>

<!-- ğŸ†• å±¥æ­´ãƒ­ã‚° -->
<div id="historyLog" class="history-log-container"></div>

<script>
// ===== ãƒãƒ£ãƒ¼ãƒˆæç”»ã¨ãƒ­ã‚¸ãƒƒã‚¯éƒ¨åˆ† =====
const cvs=document.getElementById('chart'),ctx=cvs.getContext('2d');
function resize(){cvs.width=innerWidth;cvs.height=innerHeight*0.58;}
addEventListener('resize',resize);resize();

let rate=150.000,balance=1000000,payout=1.8,stake=1000,candles=[],tickets=[],volBase=0.004,last=performance.now();
const baseVisible=90;

// åˆæœŸãƒ‡ãƒ¼ã‚¿
for(let i=0;i<200;i++){
  const prev=i?candles[i-1].c:rate;
  const c=+(prev*(1+(Math.random()-0.5)*volBase)).toFixed(3);
  const spread=Math.abs(c-prev)*0.6+0.005;
  candles.push({o:prev,h:Math.max(prev,c)+spread,l:Math.min(prev,c)-spread,c});
  rate=c;
}

// UI
const sel=document.getElementById('expirySelect'),customRow=document.getElementById('customRow'),customMin=document.getElementById('expiryCustomMin');
sel.onchange=()=>customRow.style.display=sel.value==='custom'?'':'none';
document.getElementById('stake').onchange=(e)=>stake=+e.target.value||1000;
document.getElementById('payout').onchange=(e)=>payout=+e.target.value||1.8;

// åˆ¤å®šæ™‚é–“è¨ˆç®—
function getExpirySeconds(){
  return sel.value==='custom'
    ? Math.max(30,(+customMin.value||1)*60)
    : sel.value*60;
}

// å±¥æ­´ãƒ‘ãƒãƒ«
const historyLog=document.getElementById("historyLog");
let id=1;

function addHistory(entry){
  const div=document.createElement('div');
  div.classList.add('history-entry');
  div.setAttribute("data-id", entry.id);
  div.innerHTML=`
    <strong>${entry.dir}</strong> @ ${entry.entry.toFixed(3)}<br>
    çŠ¶æ…‹ï¼šåˆ¤å®šä¸­...<br>
    åˆ¤å®šçµ‚äº†ï¼š${new Date(entry.end).toLocaleTimeString()}
  `;
  historyLog.prepend(div);
}

function updateHistory(entry){
  const target=historyLog.querySelector(`[data-id="${entry.id}"]`);
  if(!target)return;
  target.className=`history-entry ${entry.state}`;
  target.innerHTML=`
    <strong>${entry.dir}</strong> @ ${entry.entry.toFixed(3)}<br>
    çµæœï¼š${entry.state.toUpperCase()}<br>
    ç¾åœ¨å€¤ï¼š${rate.toFixed(3)}<br>
    åˆ¤å®šçµ‚äº†ï¼š${new Date(entry.end).toLocaleTimeString()}
  `;
}

// å–å¼•
function enter(dir){
  if(balance<stake){alert('æ®‹é«˜ä¸è¶³ã§ã™');return;}
  const sec=getExpirySeconds();
  const entry={id:id++,dir,entry:rate,expiry:sec,end:Date.now()+sec*1000,state:'pending'};
  tickets.push(entry);
  addHistory(entry); // ğŸ†• åˆ¤å®šå‰ã‹ã‚‰è¡¨ç¤º
  render();
}

// åˆ¤å®š
function settle(){
  const now=Date.now();
  for(const t of tickets){
    if(t.state==='pending'&&now>=t.end){
      const win=t.dir==='HIGH'?(rate>t.entry):(rate<t.entry);
      t.state=win?'win':'lose';
      balance+=win?Math.round(stake*(payout-1)):-stake;
      updateHistory(t); // ğŸ†• çµæœæ›´æ–°
    }
  }
}

// ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿æ›´æ–°
function step(){rate=+(rate*(1+(Math.random()-0.5)*volBase)).toFixed(3);}
function push(){
  const o=candles.length?candles[candles.length-1].c:rate;
  step(); const c=rate;
  const spread=Math.abs(c-o)*0.6+0.005;
  candles.push({o,h:Math.max(o,c)+spread,l:Math.min(o,c)-spread,c});
  if(candles.length>400)candles.shift();
}

// ãƒãƒ£ãƒ¼ãƒˆæç”»
function render(){
  const w=cvs.width,h=cvs.height;
  ctx.clearRect(0,0,w,h);
  const total=candles.length,visible=Math.min(total,baseVisible),start=total-visible,slice=candles.slice(start);
  const highs=slice.map(c=>c.h),lows=slice.map(c=>c.l);
  const vmin=Math.min(...lows),vmax=Math.max(...highs);
  const x=i=>20+i*(w-40)/(visible-1),y=v=>h-(v-vmin)/(vmax-vmin+1e-9)*h;
  const barW=(w-40)/visible*0.6;

  slice.forEach((c,i)=>{
    const X=x(i),yo=y(c.o),yc=y(c.c),yh=y(c.h),yl=y(c.l);
    const up=c.c>=c.o;
    ctx.strokeStyle=up?'rgba(34,197,94,0.9)':'rgba(239,68,68,0.9)';
    ctx.beginPath();ctx.moveTo(X,yh);ctx.lineTo(X,yl);ctx.stroke();
    ctx.fillStyle=up?'rgba(34,197,94,0.35)':'rgba(239,68,68,0.35)';
    const top=Math.min(yo,yc),bot=Math.max(yo,yc),hh=Math.max(2,bot-top);
    ctx.fillRect(X-barW/2,top,barW,hh);ctx.strokeRect(X-barW/2,top,barW,hh);
  });

  // ç¾åœ¨ãƒ¬ãƒ¼ãƒˆ
  const curX=x(slice.length-1),curY=y(rate);
  ctx.strokeStyle='rgba(251,191,36,0.66)';
  ctx.beginPath();ctx.moveTo(curX,0);ctx.lineTo(curX,h);ctx.stroke();

  // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ©ã‚¤ãƒ³
  for(const t of tickets){
    if(t.state==='pending'){
      const yy=y(t.entry);
      ctx.setLineDash([6,6]);
      ctx.strokeStyle=t.dir==='HIGH'?'rgba(34,197,94,.95)':'rgba(239,68,68,.95)';
      ctx.beginPath();ctx.moveTo(20,yy);ctx.lineTo(w-20,yy);ctx.stroke();
      ctx.setLineDash([]);
    }
  }

  // UIæ›´æ–°
  document.getElementById('rateText').textContent=rate.toFixed(3);
  document.getElementById('bal').textContent='Â¥'+balance.toLocaleString('ja-JP');
  const list=document.getElementById('tickets');
  list.innerHTML=tickets.slice(-4).reverse().map(t=>{
    const remain=Math.max(0,Math.ceil((t.end-Date.now())/1000));
    const txt=t.state==='pending'?(remain>=60?`${Math.floor(remain/60)}åˆ†${remain%60}ç§’`:`${remain}ç§’`):t.state.toUpperCase();
    return `<div class="ticket ${t.state||''}"><div>${t.dir} @ ${t.entry.toFixed(3)}</div><div>${txt}</div></div>`;
  }).join('');
}

// ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
function loop(ts){
  if(ts-last>=1000){
    last=ts;push();settle();render();
  }
  requestAnimationFrame(loop);
}
render();requestAnimationFrame(loop);
</script>

</body>
</html>
